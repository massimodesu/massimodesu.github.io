<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>18+ Video Access</title>
  <style>
    :root{--bg:#0f1115;--card:#151821;--muted:#9aa3b2;--accent:#3b82f6;--border:#232838;--txt:#e8e8e8}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .page{min-height:100vh}
    .head{padding:16px 14px 0}
    .chip{display:inline-block;font-size:11px;color:var(--muted);border:1px solid var(--border);border-radius:999px;padding:4px 8px}
    h1{font-size:18px;margin:10px 0 6px;line-height:1.25}
    .handle{font-size:12px;color:var(--muted);margin-bottom:8px}
    .handle a{color:var(--muted);text-decoration:none}
    .preview{margin:10px 14px 8px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:#0b0d12}
    .frame{position:relative;width:100%;padding-top:56.25%}
    .frame>img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block}
    .note{font-size:12px;color:var(--muted);margin:8px 14px 12px}
    .ad-slot{display:flex;justify-content:center;margin:12px 0}
    .ad-300x250{width:300px;height:250px}
    .ad-320x50{width:320px;height:50px}
    .actions{padding:14px}
    .btn{width:100%;display:inline-block;text-align:center;border:0;border-radius:14px;padding:14px 16px;background:var(--accent);color:#fff;font-weight:800;font-size:16px}
    .status{margin-top:8px;font-size:12px;color:var(--muted);text-align:center}
    .sticky-ad{position:fixed;left:0;right:0;bottom:0;padding:6px 0;background:rgba(15,17,21,.9);backdrop-filter:blur(6px);border-top:1px solid var(--border);display:flex;justify-content:center;z-index:50}
    .spacer{height:70px}
    @media (min-width:768px){
      .head,.note,.actions{max-width:760px;margin:0 auto}
      .preview{max-width:760px;margin-inline:auto}
    }
  </style>
</head>
<body>
<div class="page">
  <div class="head">
    <span class="chip">18+ content â€¢ adults only</span>
    <h1 id="title">Confirm 18+ to watch</h1>
    <div class="handle">channel:
      <a href="https://t.me/massimo_desu" target="_blank" rel="noopener">@massimo_desu</a>
    </div>
  </div>

  <div class="preview"><div class="frame" id="preview"></div></div>
  <p class="note" id="note">Enjoy your time watching, dear anime connoisseurs, stay with usðŸ«¦</p>

  <!-- 300Ã—250 (TOP) -->
  <div class="ad-slot">
    <div class="ad-300x250">
      <script>
        atOptions = {
          key: 'c493e0c00ad06c76089c47fdbb8fc023',
          format: 'iframe',
          height: 250,
          width: 300,
          params: { psid: 'top300' }  // SubID
        };
      </script>
      <script src="//www.highperformanceformat.com/c493e0c00ad06c76089c47fdbb8fc023/invoke.js"></script>
    </div>
  </div>

  <!-- 300Ã—250 (BOTTOM, lazy) -->
  <div class="ad-slot">
    <div class="ad-300x250" id="lazy300bottom"></div>
  </div>

  <div class="actions">
    <button class="btn" id="watchBtn">Watch FULL</button>
    <div class="status" id="status"></div>
  </div>
  <div class="spacer"></div>
</div>

<!-- Sticky 320Ã—50 -->
<div class="sticky-ad">
  <div class="ad-320x50">
    <script>
      atOptions = {
        key: '4408059fb33cba75abbc00cec4c087af',
        format: 'iframe',
        height: 50,
        width: 320,
        params: { psid: 'sticky320' } // SubID
      };
    </script>
    <script src="//www.highperformanceformat.com/4408059fb33cba75abbc00cec4c087af/invoke.js"></script>
  </div>
</div>

<script>
  // --------- HASH ---------
  function parseHash(){
    const raw=(location.hash||"").replace(/^#/,""); const out={}; if(!raw) return out;
    raw.split("|").forEach(p=>{const i=p.indexOf("="); if(i>0){out[p.slice(0,i).trim()]=decodeURIComponent(p.slice(i+1).trim());}});
    return out;
  }
  const p=parseHash();
  const V=p.v||""; const IMG=p.img||""; const D=Math.max(0,parseInt(p.delay||"7",10));
  if(p.t)   document.getElementById("title").textContent=p.t;
  if(p.btn) document.getElementById("watchBtn").textContent=p.btn;
  if(p.note)document.getElementById("note").textContent=p.note;

  // cover
  const DEFAULT_IMG="/three_girls_crop_1280x720.jpg";
  const im=document.createElement('img'); im.loading='lazy'; im.alt='Cover'; im.src=IMG||DEFAULT_IMG;
  document.getElementById('preview').appendChild(im);

  // auto-resume
  (function(){
    try{
      const raw=localStorage.getItem('vgate_next');
      if(raw){
        const o=JSON.parse(raw);
        if(o && o.url && Date.now()-(o.ts||0)<2*60*1000 && !location.hash.includes('v=')){
          location.replace(o.url);
        }
      }
    }catch(e){}
  })();

  // lazy-load bottom 300x250
  (function(){
    const slot=document.getElementById('lazy300bottom'); if(!slot) return;
    function inject(){
      if(slot.dataset.loaded) return; slot.dataset.loaded=1;
      const s1=document.createElement('script');
      s1.textContent="atOptions={key:'c493e0c00ad06c76089c47fdbb8fc023',format:'iframe',height:250,width:300,params:{psid:'bottom300'}};";
      const s2=document.createElement('script');
      s2.src='//www.highperformanceformat.com/c493e0c00ad06c76089c47fdbb8fc023/invoke.js';
      slot.append(s1,s2);
    }
    if('IntersectionObserver' in window){
      const io=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){inject(); io.disconnect();}})},{root:null,rootMargin:'200px 0px'});
      io.observe(slot);
    }else{ inject(); }
  })();

  // ---------- Telegram: Ð²Ñ–Ð´ÐºÑ€Ð¸Ð²Ð°Ñ”Ð¼Ð¾ bridge Ð² Ð¢Ð†Ð™ Ð¡ÐÐœÐ†Ð™ Ð²ÐºÐ»Ð°Ð´Ñ†Ñ– ----------
  const isTG = /Telegram/i.test(navigator.userAgent)
               || !!window.TelegramWebviewProxy
               || (window.Telegram && window.Telegram.WebApp);

  function buildBridgeUrl(v, d){
    const u = new URL('bridge.html', location.origin);
    u.hash = 'v='+encodeURIComponent(v)+'|delay='+encodeURIComponent(d);
    return u.toString();
  }
  function robustGo(url){
    try{location.assign(url);}catch(e){}
    try{location.replace(url);}catch(e){}
    try{window.open(url,'_self');}catch(e){}
  }

  const statusEl=document.getElementById('status');
  const btn=document.getElementById('watchBtn');
  if(!V){btn.disabled=true; statusEl.textContent='Error: missing video URL (v= in the hash).';}

  btn.addEventListener('click', ()=>{
    try{ localStorage.setItem('vgate_next', JSON.stringify({url: V, ts: Date.now()})); }catch(e){}

    if(isTG){
      location.href = buildBridgeUrl(V, D); // Ð±ÐµÐ· about:blank
      return;
    }

    // Ð†Ð½ÑˆÑ– Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð¸ â†’ Ñ‚Ð°Ð¹Ð¼ÐµÑ€ Ñ– Ð¿Ñ€ÑÐ¼Ð¸Ð¹ Ñ€ÐµÐ´Ñ–Ñ€ÐµÐºÑ‚
    const end=Date.now()+D*1000;
    (function tick(){
      const left=Math.max(0,Math.ceil((end-Date.now())/1000));
      statusEl.textContent='Preparing your videoâ€¦ '+left+'s';
      if(Date.now()>=end){ goFinal(); } else setTimeout(tick,250);
    })();
    function goFinal(){ robustGo(V); }
    setTimeout(goFinal,(D+0.4)*1000);
    setTimeout(goFinal,(D+2.0)*1000);
    setTimeout(goFinal,(D+4.0)*1000);
  });
</script>
</body>
</html>
