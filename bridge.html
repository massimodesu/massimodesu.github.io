<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Continue…</title>
  <style>
    :root{--bg:#0f1115;--card:#151821;--muted:#9aa3b2;--accent:#3b82f6;--border:#232838;--txt:#e8e8e8}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
    .card{width:100%;max-width:680px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:0 6px 30px rgba(0,0,0,.35)}
    h1{font-size:18px;margin:0 0 6px}
    .muted{font-size:12px;color:var(--muted);margin-bottom:12px}
    .ad-slot{display:flex;justify-content:center;margin:10px 0}
    .ad-300x250{width:300px;height:250px}
    .ad-320x50{width:320px;height:50px}
    .status{margin-top:10px;font-size:12px;color:var(--muted);text-align:center}
    .row{display:flex;gap:10px;justify-content:center;margin-top:8px}
    .btn{border:1px solid var(--border);background:transparent;color:#e8e8e8;border-radius:12px;padding:10px 14px;font-weight:700}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Preparing your video…</h1>
    <div class="muted">Please wait a moment. You will be redirected automatically.</div>

    <!-- 300×250 #1 -->
    <div class="ad-slot">
      <div class="ad-300x250">
        <script>
          atOptions = { key:'c493e0c00ad06c76089c47fdbb8fc023', format:'iframe', height:250, width:300, params:{psid:'bridge300_1'} };
        </script>
        <script src="//www.highperformanceformat.com/c493e0c00ad06c76089c47fdbb8fc023/invoke.js"></script>
      </div>
    </div>

    <!-- 300×250 #2 (lazy) -->
    <div class="ad-slot">
      <div class="ad-300x250" id="lazy300_2"></div>
    </div>

    <div class="row" id="xtraRow" style="display:none">
      <button class="btn" id="openExternalB">Open in Browser</button>
    </div>

    <div class="status" id="status">Loading…</div>
  </div>
</div>

<!-- Sticky 320×50 -->
<div style="position:fixed;left:0;right:0;bottom:0;padding:6px 0;background:rgba(15,17,21,.9);backdrop-filter:blur(6px);border-top:1px solid var(--border);display:flex;justify-content:center;z-index:50">
  <div class="ad-320x50">
    <script>
      atOptions = { key:'4408059fb33cba75abbc00cec4c087af', format:'iframe', height:50, width:320, params:{psid:'bridge_sticky'} };
    </script>
    <script src="//www.highperformanceformat.com/4408059fb33cba75abbc00cec4c087af/invoke.js"></script>
  </div>
</div>

<script>
  function parseHash(){
    const raw=(location.hash||"").replace(/^#/,""); const out={}; if(!raw) return out;
    raw.split("|").forEach(p=>{const i=p.indexOf("="); if(i>0){out[p.slice(0,i).trim()]=decodeURIComponent(p.slice(i+1).trim());}});
    return out;
  }
  const p=parseHash(); const V=p.v||"";
  let D = Math.max(0, parseInt(p.delay || "5", 10));

  const isTG = /Telegram/i.test(navigator.userAgent) || !!window.TelegramWebviewProxy || (window.Telegram && window.Telegram.WebApp);
  const isAndroid = /Android/i.test(navigator.userAgent);
  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

  // ===== AUTO open this page in Chrome if Telegram on Android =====
  (function autoExternalizeIfTGAndroid(){
    if(!isTG || !isAndroid) return;
    if(sessionStorage.getItem('ext_auto_tried')) return;
    sessionStorage.setItem('ext_auto_tried','1');
    try{
      const current = location.href;
      const noScheme = current.replace(/^https?:\/\//,'');
      const fallback = encodeURIComponent(current);
      const intent = `intent://${noScheme}#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=${fallback};end`;
      location.href = intent;
    }catch(e){}
  })();

  if (isTG) D = Math.max(D, 9); // мінімум 9с у TG

  const statusEl=document.getElementById('status');
  if(!V){ statusEl.textContent='Error: missing video URL.'; throw new Error('no V'); }

  // показати "Open in Browser" тільки у TG
  if(isTG){ document.getElementById('xtraRow').style.display='flex'; }
  document.getElementById('openExternalB').addEventListener('click', async ()=>{
    if(isAndroid){
      const noScheme = V.replace(/^https?:\/\//,'');
      const intent = 'intent://'+noScheme+'#Intent;scheme=https;package=com.android.chrome;end';
      location.href = intent;
      setTimeout(()=>{ location.href = V; }, 1200);
    }else if(isIOS){
      try{ await navigator.clipboard?.writeText(V);}catch(e){}
      alert('Open in Safari: tap ⋯ → "Open in Safari". Link copied to clipboard.');
    }else{
      try{location.assign(V);}catch(e){}
    }
  });

  // lazy другого 300×250
  (function(){
    const slot=document.getElementById('lazy300_2'); if(!slot) return;
    function inject(){
      if(slot.dataset.loaded) return; slot.dataset.loaded=1;
      const s1=document.createElement('script');
      s1.textContent="atOptions={key:'c493e0c00ad06c76089c47fdbb8fc023',format:'iframe',height:250,width:300,params:{psid:'bridge300_2'}};";
      const s2=document.createElement('script');
      s2.src='//www.highperformanceformat.com/c493e0c00ad06c76089c47fdbb8fc023/invoke.js';
      slot.append(s1,s2);
    }
    if('IntersectionObserver' in window){
      const io=new IntersectionObserver(es=>{es.forEach(e=>{ if(e.isIntersecting){ inject(); io.disconnect(); } });},{root:null,rootMargin:'200px 0px'});
      io.observe(slot);
    }else{ inject(); }
  })();

  // таймер і редірект
  const end=Date.now()+D*1000;
  (function tick(){
    const left=Math.max(0,Math.ceil((end-Date.now())/1000));
    statusEl.textContent='Opening video in '+left+'s…';
    if(Date.now()>=end){ go(); } else setTimeout(tick,250);
  })();
  function go(){
    try{location.assign(V);}catch(e){}
    try{location.replace(V);}catch(e){}
    try{window.open(V,'_self');}catch(e){}
  }
  setTimeout(go,(D+0.6)*1000);
  setTimeout(go,(D+2.2)*1000);
  setTimeout(go,(D+4.2)*1000);
</script>
</body>
</html>
